name: Initialize Package

on: 
  workflow_dispatch:
    inputs:
      organizationPascal:
        description: 'The name of the organization in PascalCase.'
        required: true
      organizationKebab:
        description: 'The name of the organization in kebab-case.'
        required: true
      packagePascal:
        description: 'The name of the package in PascalCase.'
        required: true
      packageKebab:
        description: 'The name of the package in kebab-case'
        required: true

env:
  ORGANIZATION_PASCAL: ${{ github.event.inputs.organizationPascal }}
  ORGANIZATION_KEBAB: ${{ github.event.inputs.organizationKebab }}
  PACKAGE_PASCAL: ${{ github.event.inputs.projectPascal }}
  PACKAGE_KEBAB: ${{ github.event.inputs.projectKebab }}

jobs:
  initialization:
    name: Initialize Package
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Find and Replace Package Name
        run: |
          cd Packages

          find . -type f -name "*.json" -exec sed -i 's/__my-organization__/${ORGANIZATION_KEBAB}/g' {} +
          find . -type f -name "*.json" -exec sed -i 's/__my-project__/${PACKAGE_KEBAB}/g' {} +
          
          find . -type f -name "*.cs" -o -name "*.md" -o -name "*.asmdef" -exec sed -i 's/__MyOrganization__/${ORGANIZATION_PASCAL}/g' {} +
          find . -type f -name "*.cs" -o -name "*.md" -o -name "*.asmdef" -exec sed -i 's/__MyPackage__/${PACKAGE_PASCAL}/g' {} +

          find . -type f -name "*.asmdef" -exec bash -c 'mv "$2" "${2/__MyOrganization__/$1}"' -- ${ORGANIZATION_PASCAL} {} \;
          find . -type f -name "*.asmdef" -exec bash -c 'mv "$2" "${2/__MyPackage__/$1}"' -- ${PACKAGE_PASCAL} {} \;
          find . -type f -name "*.asmdef.meta" -exec bash -c 'mv "$2" "${2/__MyOrganization__/$1}"' -- ${ORGANIZATION_PASCAL} {} \;
          find . -type f -name "*.asmdef.meta" -exec bash -c 'mv "$2" "${2/__MyPackage__/$1}"' -- ${PACKAGE_PASCAL} {} \;
          find . -type f -name "*.md" -exec bash -c 'mv "$2" "${2/__MyOrganization__/$1}"' -- ${ORGANIZATION_PASCAL} {} \;
          find . -type f -name "*.md" -exec bash -c 'mv "$2" "${2/__MyPackage__/$1}"' -- ${PACKAGE_PASCAL} {} \;

          mv com.__my-organization__.__my-project__ com.${ORGANIZATION_KEBAB}.${PACKAGE_KEBAB}
      
      - name: Commit Changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: 'chore: Initialize Package [skip ci]'
